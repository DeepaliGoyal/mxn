<html>
<head>
	<script src="http://code.jquery.com/jquery-1.8.2.min.js" type="text/javascript"></script>
	<script type="text/javascript">
    var googlev3_key = 'AIzaSyDW21lnrSsBk4OyHUDmBQ7su9di3yMaO7I';
    var nokia_app_id = 'FbgYuugcrj8Taq6JjmUK';
    var nokia_auth_token = 'Yy2i2n98kaWj69qysOmcYg';
    var microsoftv7_key = 'AlneHdcKOFDot4FjwyuLH8ZSUIz5rv_X22vULKa7H5ia0JnsxiykdO8y-dgLQMU6';
    var openspace_key = 'CEEFBE51588492CBE0405F0ACA6010B1';
    var mapquest_key = 'Fmjtd%7Cluub29uy25%2Crs%3Do5-96zl9y';
    var yandexv1_key = 'AMVH-VABAAAAEdVkcQIAOS-fmBYJfLFV-YDg7ZCPjwVQycUAAAAAAAAAAADwTFcvgPirz7OV75IX_Gsopsw7jA==';
	
    var provider;

    {
        var providerMatch = location.search.match( /provider=([^&]*)/ );
        var autorunMatch = location.search.match( /auto=([^&]*)/ );

        if (providerMatch) {
            provider = providerMatch[1];
        }
		
        else {
            provider = 'google';
        }

        if (autorunMatch) {
            autoRun = autorunMatch[1];
            if (autoRun !== 'true') {
                autoRun = 'false';
            }
        }
	
        document.write('<script type="text/javascript" src="../source/mxn.js?(' + provider + ',[autoload])"><\/script>');
    }

    $(document).ready(function () {

        var providerElm = document.getElementById('provider');

        providerElm.innerHTML = provider;

        //TODO: move this to utils?
        var supportedProviders = [];
        for (var prov in mxn.Providers) {
            if (mxn.Providers[prov].state === "active" && mxn.Providers[prov].type === "master") {
                supportedProviders.push(prov.valueOf());
            }
        }

        var list = document.getElementById("providers");

        for (var prov in supportedProviders) {
            var newli = document.createElement("li");
            var newlink = document.createElement("a");
            var newname = document.createTextNode(supportedProviders[prov]);
            newli.appendChild(newlink);
            newlink.appendChild(newname);
            newlink.href = location.pathname + "?provider=" + supportedProviders[prov];
            list.appendChild(newli);
        };

		var props = {
			controls: {
				pan: true,
				zoom: 'large',
				overview: true,
				scale: true,
				map_type: true
			},
			center: new mxn.LatLonPoint(51.50730, -0.12763),
			zoom: 8,
			map_type: mxn.Mapstraction.ROAD
		};
		var map = new mxn.Mapstraction('map', provider, props);

		var basemaps = {
			osm: {
				url: 'http://{S}.tile.openstreetmap.org/{Z}/{X}/{Y}.png',
				name: 'osm',
				options: {
					label: 'OSM',
					alt: 'OpenStreetMap Streets',
					attribution: 'CC-BY-SA © OpenStreetMap contributors',
					opacity: 1.0,
					minZoom: 1,
					maxZoom: 18,
					subdomains: ['a', 'b', 'c']
				}
			},			
			esri: {
				url: 'http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',
				name: 'esri',
				options: {
					label: 'Esri',
					alt: 'Esri World Streets',
					attribution: 'Tiles &copy; Esri',
					opacity: 1.0,
					minZoom: 1,
					maxZoom: 18
				}
			}   
		};
		
		for (bm in basemaps) {
			//basemaps[bm].baseMapControlAdded.addHandler(defaultBaseMapHandler);
			//basemaps[bm].baseMapControlRemoved.addHandler(defaultBaseMapHandler);
		}
		
		var overlays = {
			toner: new mxn.TileMap ({
					url: 'http://tile.stamen.com/toner/{Z}/{X}/{Y}.png',
					name: 'toner',
					type: mxn.Mapstraction.TileType.OVERLAY,
					options: {
						label: 'Toner',
						alt: 'Toner',
						attribution: 'CC-BY-SA © OpenStreetMap contributors',
						opacity: 0.5,
						minZoom: 1,
						maxZoom: 18,
					}
				}),
			watercolor: new mxn.TileMap ({
					url: 'http://tile.stamen.com/watercolor/{Z}/{X}/{Y}.png',
					name: 'watercolor',
					type: mxn.Mapstraction.TileType.OVERLAY,
					options: {
						label: 'Watercolor',
						attribution: 'CC-BY-SA © OpenStreetMap contributors',
						opacity: 0.5,
						minZoom: 1,
						maxZoom: 18
					}
				}),
			    weather: new mxn.TileMap ({
					url: 'http://tile.openweathermap.org/map/pressure_cntr/{z}/{x}/{y}.png',
					name: 'weather',
					type: mxn.Mapstraction.TileType.OVERLAY,
					options: {
						label: 'Weather',
						alt: 'Weather',
						attribution: 'CC-BY-SA © OpenStreetMap contributors',
						opacity: 1.0,
						minZoom: 1,
						maxZoom: 18
					}
				})
		};

		$('#set-road').click(function() {
			map.setMapType(mxn.Mapstraction.ROAD);
		});
		$('#set-satellite').click(function() {
			map.setMapType(mxn.Mapstraction.SATELLITE);
		});
		$('#set-hybrid').click(function() {
			map.setMapType(mxn.Mapstraction.HYBRID);
		});
		$('#set-physical').click(function() {
			map.setMapType(mxn.Mapstraction.PHYSICAL);
		});

		$('#map-osm').click(function() {
			map.addBaseMap(basemaps.osm, {
				addControl: true,
				makeCurrent: true
			});
		});
		$('#add-osm').click(function() {
			basemaps.osm.addControl();
		});
		$('#set-osm').click(function() {
			map.setMapType('osm');
		});
		$('#remove-osm').click(function() {
			basemaps.osm.removeControl();
		});

		$('#map-esri').click(function() {
			map.addBaseMap(basemaps.esri, {
				addControl: false,
				makeCurrent: false
			});
		});
		$('#add-esri').click(function() {
			//basemaps.esri.addControl();
		});
		$('#set-esri').click(function() {
			map.setMapType('esri');
		});
		$('#remove-esri').click(function() {
			//basemaps.esri.removeControl();
		});

		var acetate;
		$('#map-acetate').click(function() {
			acetate = map.addBaseMap('mxn.BaseMapProviders.Acetate.terrain', {
				addControl: false,
				makeCurrent: true
			});
			if (acetate !== null) {
				acetate.baseMapControlAdded.addHandler(defaultBaseMapHandler);
				acetate.baseMapControlRemoved.addHandler(defaultBaseMapHandler);
			}
		})
		$('#add-acetate').click(function() {
			acetate.addControl();
		});
		$('#set-acetate').click(function() {
			map.setMapType('mxn.BaseMapProviders.Acetate.terrain');
		});
		$('#remove-acetate').click(function() {
			acetate.removeControl();
		});

		$('#add-toner').click(function () {
		    map.addTileMap(overlays.toner);
		});
		$('#show-toner').click(function() {
			overlays.toner.show();
		});
		$('#hide-toner').click(function() {
			overlays.toner.hide();
		});

		$('#add-watercolor').click(function() {
			map.addTileMap(overlays.watercolor);
		});
		$('#show-watercolor').click(function() {
			overlays.watercolor.show();
		});
		$('#hide-watercolor').click(function() {
			overlays.watercolor.hide();
		});

		$('#add-weather').click(function() {
			map.addTileMap(overlays.weather);
		});
		$('#show-weather').click(function() {
			overlays.weather.show();
		});
		$('#hide-weather').click(function() {
			overlays.weather.hide();
		});
	});
	</script>
	<style type="text/css">
	#map {
		width: 82%;
		height: 75%;
	}
	#nav {
		font: 400 17px/1.3 "Helvetica Neue", sans-serif;
	}
    #provider-selection {
        margin: 0px;
        padding-left: 10px;
        display: inline-block;
        float: right;
    }
	</style>
</head>
<body>
    <h2>Mapstraction Overlays Example for Provider "<span id="provider"></span>"</h2>
    <div id="provider-selection">
        <h3>Providers</h3>
        <ul id="providers"></ul>
    </div>

	<div id="map"></div>
	<div id="nav">
		<strong>Default Base Maps:</strong> <a href="#" id="set-road">Road</a>|<a href="#" id="set-satellite">Satellite</a>|<a href="#" id="set-hybrid">Hybrid</a>|<a href="#" id="set-physical">Physical</a>
		<br />
		<strong>Custom Base Maps:</strong> <em>OSM</em>: <a href="#" id="map-osm">Map</a>|<a href="#" id="add-osm">Add</a>|<a href="#" id="set-osm">Set</a>|<a href="#" id="remove-osm">Remove</a>, <em>Esri</em>: <a href="#" id="map-esri"> Map</a>|<a href="#" id="add-esri">Add</a>|<a href="#" id="set-esri">Set</a>|<a href="#" id="remove-esri">Remove</a>, <em>Acetate</em>: <a href="#" id="map-acetate">Map</a>|<a href="#" id="add-acetate">Add</a>|<a href="#" id="set-acetate">Set</a>|<a href="#" id="remove-acetate">Remove</a>
		<br />
		<strong>Custom Overlays:</strong> <em>Toner</em> : <a href="#" id="add-toner">Add</a>|<a href="#" id="show-toner">Show</a>|<a href="#" id="hide-toner">Hide</a> <em>Watercolor</em> : <a href="#" id="add-watercolor">Add</a>|<a href="#" id="show-watercolor">Show</a>|<a href="#" id="hide-watercolor">Hide</a> <em>Pressure Contours</em> : <a href="#" id="add-weather">Add</a>|<a href="#" id="show-weather">Show</a>|<a href="#" id="hide-weather">Hide</a>
	</div>
</body>
</html>